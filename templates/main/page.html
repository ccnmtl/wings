{% extends 'base.html' %}
{% load render %}
{% load smartif %}
{% load random_image %}

{% block js %}
{% for block in section.pageblock_set.all %}
{% renderjs block %}
{% endfor %}


<script src="/site_media/js/jquery-1.4.2.min.js" type="text/javascript" ></script> 
{%if request.user.part %}
    {% if request.user.part.current_section == section %}
        <script src="/site_media/js/delay_next.js" type="text/javascript" ></script> 
    {%endif %}
{%endif %}

{% if needs_submit %}
    <!-- TODO move this to quiz js template-->
    <script language = "javascript">    
        function submit_when_changed(thing) {
            jQuery('#submit_to_self_form').submit();
        }
    
        function connect_forms () {
            jQuery('input[type="text"]') .blur(submit_when_changed);
            jQuery('input[type="text"]') .change(submit_when_changed);
            jQuery('input[type="radio"]').blur(submit_when_changed);
            jQuery('input[type="radio"]').change(submit_when_changed);
        }
        jQuery (connect_forms)
    </script>
{%endif%}

{% endblock %}

{% block css %}
{% for block in section.pageblock_set.all %}
{% rendercss block %}
{% endfor %}
{% endblock %}


{% block title %}{% endblock %}

{% block sidenav %}
        <!-- ###### Secondary Navigation ###### -->
    {% if not user.part%}
        <div id="secondary_navigation">
                <div id="fadetop"></div>
                <div class="block">
                  {% if module.get_children %}
                        <h3>Sections</h3>
                        {% include "main/menu.html" %}
                  {% endif %}
                </div><!-- div id="block" -->
                <div id="fadebottom"></div>
        </div><!-- div id="secondary_navigation" -->
    {%endif %}
{% endblock %}



{% block content %}

{% for block in section.pageblock_set.all %}
    {% if block.block.is_audio_block %}
        {% render block %}
    {%endif %}
{% endfor %}

<h3>{{section.label}}</h3>


{% if show_decorations %}
    <img class="decoration_image_{{'12'|make_list|random}}"  src = '/site_media/{% random_image "/img/decoration_images/" %}' />
    </div>
{% endif %}

{% if messages %}
    <ul class="messages">
        {% for message in messages %}
            <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
        {% endfor %}
    </ul>
{% endif %}


{% if needs_submit %}
<form id="submit_to_self_form" action="." method="post">
{% endif %}


{% for block in section.pageblock_set.all %}
    {% if not block.block.is_help_block and not block.block.is_audio_block %}
        {% if block.label %}<h3>{{block.label}}</h3>{% endif %}
        {% render block %}
    {%endif %}
{% endfor %}


{% if needs_submit %}
</form>
{% endif %}

{% endblock %}
<div class="visualclear"></div>

{% block content-nav %}

<div class="content-nav">
    <!-- Django messages go here-- e.g. "Please finish all quiz answers before continuing."-->
{% if section.get_previous %}
<a href="{{section.get_previous.get_absolute_url}}" id="previous">« {{section.get_previous.label}}</a>
{% endif %}


{% if section.get_next %}
    {% with section.get_next as next_section %}
        <a href="{{section.get_next.get_absolute_url}}" id="next">{{section.get_next.label}} »</a>
    {% endwith %}
{% endif %}
{% for block in section.pageblock_set.all %}
    {% if block.block.is_help_block %}
       {% render block %}
    {%endif %}
{% endfor %}

</div>
{% endblock %}
